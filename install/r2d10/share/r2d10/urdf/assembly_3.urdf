<?xml version="1.0"?>
<robot name="assembly_3" xmlns:xacro="http://www.ros.org/wiki/xacro">

<material name="silver">
  <color rgba="0.700 0.700 0.700 1.000"/>
</material>

<material name="black">
  <color rgba="0 0 0 1"/>
</material>

<!-- BASE LINK -->
<link name="base_link">
  <inertial>
    <origin xyz="-6.745525765719935e-05 0.0012816498954868177 0.0354047315459432" rpy="0 0 0"/>
    <mass value="37.821366170820795"/>
    <inertia ixx="0.23125" iyy="0.223709" izz="0.423982" ixy="-0.000124" iyz="0.000747" ixz="-3.9e-05"/>
  </inertial>
  <visual>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/base_link.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="silver"/> 
  </visual>
  <collision>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/base_link.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<!-- CASTER LINK -->
<link name="caster_1">
  <inertial>
    <origin xyz="0.0 0.11 -0.0043996518255540636" rpy="0 0 0"/>
    <mass value="0.0707011858312227"/>
    <inertia ixx="6e-06" iyy="6e-06" izz="1e-05" ixy="0.0" iyz="-0.0" ixz="0.0"/>
  </inertial>
  <visual>
    <origin xyz="-0.0 -0.0 -0.0" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/caster_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="silver"/>
  </visual>
  <collision>
    <origin xyz="-0.0 -0.0 -0.0" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/caster_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<!-- LEFT WHEEL LINK -->
<link name="left_wheel_1">
  <inertial>
    <origin xyz="-0.012500000000000011 0.0 0.0" rpy="0 0 0"/>
    <mass value="0.6512177959195155"/>
    <inertia ixx="0.000344" iyy="0.000206" izz="0.000206" ixy="0.0" iyz="-0.0" ixz="0.0"/>
  </inertial>
  <visual>
    <origin xyz="0.085 0.0475 -0.02" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/left_wheel_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="black"/>
  </visual>
  <collision>
    <origin xyz="0.085 0.0475 -0.02" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/left_wheel_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<!-- RIGHT WHEEL LINK -->
<link name="right_wheel_1">
  <inertial>
    <origin xyz="0.012500000000000108 0.0 -6.938893903907228e-18" rpy="0 0 0"/>
    <mass value="0.6512177959195155"/>
    <inertia ixx="0.000344" iyy="0.000206" izz="0.000206" ixy="0.0" iyz="0.0" ixz="0.0"/>
  </inertial>
  <visual>
    <origin xyz="-0.09 0.0475 -0.02" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/right_wheel_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="black"/>
  </visual>
  <collision>
    <origin xyz="-0.09 0.0475 -0.02" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/right_wheel_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<!-- ULTRASONIC FORWARD LINK -->
<link name="ultrasonic_forward_1">
  <inertial>
    <origin xyz="-6.89984745874354e-13 0.005799256348663379 -6.55503359925369e-11" rpy="0 0 0"/>
    <mass value="0.06306919012201337"/>
    <inertia ixx="3e-06" iyy="1.2e-05" izz="1.2e-05" ixy="-0.0" iyz="0.0" ixz="-0.0"/>
  </inertial>
  <visual>
    <origin xyz="-0.0 -0.15 -0.035" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/ultrasonic_forward_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="silver"/>
  </visual>
  <collision>
    <origin xyz="-0.0 -0.15 -0.035" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/ultrasonic_forward_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<!-- ULTRASONIC LEFT LINK -->
<link name="ultrasonic_left_1">
  <inertial>
    <origin xyz="-0.005799256348663379 -6.899762237296075e-13 -6.55503359925369e-11" rpy="0 0 0"/>
    <mass value="0.06306919012201337"/>
    <inertia ixx="1.2e-05" iyy="3e-06" izz="1.2e-05" ixy="0.0" iyz="-0.0" ixz="-0.0"/>
  </inertial>
  <visual>
    <origin xyz="0.15 -0.0 -0.035" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/ultrasonic_left_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="silver"/>
  </visual>
  <collision>
    <origin xyz="0.15 -0.0 -0.035" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/ultrasonic_left_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<!-- ULTRASONIC RIGHT LINK -->
<link name="ultrasonic_right_1">
  <inertial>
    <origin xyz="0.005799256348663379 6.899932680191004e-13 -6.55503359925369e-11" rpy="0 0 0"/>
    <mass value="0.06306919012201337"/>
    <inertia ixx="1.2e-05" iyy="3e-06" izz="1.2e-05" ixy="0.0" iyz="0.0" ixz="0.0"/>
  </inertial>
  <visual>
    <origin xyz="-0.15 -0.0 -0.035" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/ultrasonic_right_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="silver"/>
  </visual>
  <collision>
    <origin xyz="-0.15 -0.0 -0.035" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/ultrasonic_right_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<!-- LIDAR LINK -->
<link name="lidar_1">
  <inertial>
    <origin xyz="7.385233546074017e-18 0.0 0.01999999999999999" rpy="0 0 0"/>
    <mass value="1.2084136142033137"/>
    <inertia ixx="0.000531" iyy="0.000531" izz="0.00074" ixy="0.0" iyz="0.0" ixz="0.0"/>
  </inertial>
  <visual>
    <origin xyz="-0.0 -0.0 -0.07" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/lidar_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="silver"/>
  </visual>
  <collision>
    <origin xyz="-0.0 -0.0 -0.07" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://r2d10/meshes/lidar_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<!-- JOINTS -->
<joint name="Rigid_1" type="fixed">
  <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
  <parent link="base_link"/>
  <child link="caster_1"/>
</joint>

<joint name="Revolute_2" type="continuous">
  <origin xyz="-0.085 -0.0475 0.02" rpy="0 0 0"/>
  <parent link="base_link"/>
  <child link="left_wheel_1"/>
  <axis xyz="-1.0 0.0 0.0"/>
</joint>

<joint name="Revolute_3" type="continuous">
  <origin xyz="0.09 -0.0475 0.02" rpy="0 0 0"/>
  <parent link="base_link"/>
  <child link="right_wheel_1"/>
  <axis xyz="-1.0 0.0 0.0"/>
</joint>

<joint name="Rigid_5" type="fixed">
  <origin xyz="0.0 0.15 0.035" rpy="0 0 0"/>
  <parent link="base_link"/>
  <child link="ultrasonic_forward_1"/>
</joint>

<joint name="Rigid_6" type="fixed">
  <origin xyz="-0.15 0.0 0.035" rpy="0 0 0"/>
  <parent link="base_link"/>
  <child link="ultrasonic_left_1"/>
</joint>

<joint name="Rigid_7" type="fixed">
  <origin xyz="0.15 0.0 0.035" rpy="0 0 0"/>
  <parent link="base_link"/>
  <child link="ultrasonic_right_1"/>
</joint>

<joint name="Rigid_9" type="fixed">
  <origin xyz="0.0 0.0 0.07" rpy="0 0 0"/>
  <parent link="base_link"/>
  <child link="lidar_1"/>
</joint>

<!-- GAZEBO SENSOR PLUGINS - MUST BE OUTSIDE LINK DEFINITIONS -->

<!-- LIDAR SENSOR -->
<gazebo reference="lidar_1">
  <sensor name="lidar_1" type="gpu_lidar">
    <topic>/scan</topic>
    <update_rate>10</update_rate>
    <lidar>
      <scan>
        <horizontal>
          <samples>360</samples>
          <resolution>1</resolution>
          <min_angle>-3.14159</min_angle>
          <max_angle>3.14159</max_angle>
        </horizontal>
      </scan>
      <range>
        <min>0.12</min>
        <max>8.0</max>
        <resolution>0.01</resolution>
      </range>
    </lidar>
    <always_on>true</always_on>
    <visualize>true</visualize>
  </sensor>
</gazebo>

<!-- ULTRASONIC FORWARD SENSOR -->
<gazebo reference="ultrasonic_forward_1">
  <sensor name="ultrasonic_forward_sensor" type="gpu_ray">
    <topic>ultrasonic_forward</topic>
    <update_rate>10</update_rate>
    <ray>
      <scan>
        <horizontal>
          <samples>5</samples>
          <resolution>1</resolution>
          <min_angle>-0.12</min_angle>
          <max_angle>0.12</max_angle>
        </horizontal>
        <vertical>
          <samples>5</samples>
          <resolution>1</resolution>
          <min_angle>-0.12</min_angle>
          <max_angle>0.12</max_angle>
        </vertical>
      </scan>
      <range>
        <min>0.02</min>
        <max>4.0</max>
        <resolution>0.01</resolution>
      </range>
    </ray>
    <always_on>true</always_on>
    <visualize>true</visualize>
  </sensor>
</gazebo>

<!-- ULTRASONIC LEFT SENSOR -->
<gazebo reference="ultrasonic_left_1">
  <sensor name="ultrasonic_left_sensor" type="gpu_ray">
    <topic>ultrasonic_left</topic>
    <update_rate>10</update_rate>
    <ray>
      <scan>
        <horizontal>
          <samples>5</samples>
          <resolution>1</resolution>
          <min_angle>-0.12</min_angle>
          <max_angle>0.12</max_angle>
        </horizontal>
        <vertical>
          <samples>5</samples>
          <resolution>1</resolution>
          <min_angle>-0.12</min_angle>
          <max_angle>0.12</max_angle>
        </vertical>
      </scan>
      <range>
        <min>0.02</min>
        <max>4.0</max>
        <resolution>0.01</resolution>
      </range>
    </ray>
    <always_on>true</always_on>
    <visualize>true</visualize>
  </sensor>
</gazebo>

<!-- ULTRASONIC RIGHT SENSOR -->
<gazebo reference="ultrasonic_right_1">
  <sensor name="ultrasonic_right_sensor" type="gpu_ray">
    <topic>ultrasonic_right</topic>
    <update_rate>10</update_rate>
    <ray>
      <scan>
        <horizontal>
          <samples>5</samples>
          <resolution>1</resolution>
          <min_angle>-0.12</min_angle>
          <max_angle>0.12</max_angle>
        </horizontal>
        <vertical>
          <samples>5</samples>
          <resolution>1</resolution>
          <min_angle>-0.12</min_angle>
          <max_angle>0.12</max_angle>
        </vertical>
      </scan>
      <range>
        <min>0.02</min>
        <max>4.0</max>
        <resolution>0.01</resolution>
      </range>
    </ray>
    <always_on>true</always_on>
    <visualize>true</visualize>
  </sensor>
</gazebo>

<!-- IMU SENSOR (attached to base_link) -->
<gazebo reference="base_link">
  <sensor name="imu_sensor" type="imu">
    <topic>/imu</topic>
    <update_rate>100</update_rate>
    <imu>
      <angular_velocity>
        <x>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>2e-4</stddev>
          </noise>
        </x>
        <y>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>2e-4</stddev>
          </noise>
        </y>
        <z>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>2e-4</stddev>
          </noise>
        </z>
      </angular_velocity>
      <linear_acceleration>
        <x>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>1.7e-2</stddev>
          </noise>
        </x>
        <y>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>1.7e-2</stddev>
          </noise>
        </y>
        <z>
          <noise type="gaussian">
            <mean>0.0</mean>
            <stddev>1.7e-2</stddev>
          </noise>
        </z>
      </linear_acceleration>
    </imu>
    <always_on>true</always_on>
    <visualize>false</visualize>
  </sensor>
</gazebo>

<!-- DIFFERENTIAL DRIVE -->
<gazebo>
  <plugin filename="gz-sim-diff-drive-system" name="gz::sim::systems::DiffDrive">
    <left_joint>Revolute_2</left_joint>
    <right_joint>Revolute_3</right_joint>
    <wheel_separation>0.175</wheel_separation>
    <wheel_radius>0.04</wheel_radius>
    <odom_publish_frequency>50</odom_publish_frequency>
    <topic>cmd_vel</topic>
    <odom_topic>odometry</odom_topic>
    <frame_id>odom</frame_id>
    <child_frame_id>base_link</child_frame_id>
  </plugin>
</gazebo>

<!-- JOINT STATE PUBLISHER -->
<gazebo>
  <plugin filename="gz-sim-joint-state-publisher-system" name="gz::sim::systems::JointStatePublisher"/>
</gazebo>

<!-- POSE PUBLISHER -->
<gazebo>
  <plugin filename="gz-sim-pose-publisher-system" name="gz::sim::systems::PosePublisher">
    <publish_link_pose>true</publish_link_pose>
    <use_pose_vector_msg>true</use_pose_vector_msg>
  </plugin>
</gazebo>

</robot>